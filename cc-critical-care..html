<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr John Adabie Appiah">

<title>Cardiovascular Dysfunction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="cc-critical-care._files/libs/clipboard/clipboard.min.js"></script>
<script src="cc-critical-care._files/libs/quarto-html/quarto.js"></script>
<script src="cc-critical-care._files/libs/quarto-html/popper.min.js"></script>
<script src="cc-critical-care._files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cc-critical-care._files/libs/quarto-html/anchor.min.js"></script>
<link href="cc-critical-care._files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cc-critical-care._files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cc-critical-care._files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cc-critical-care._files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cc-critical-care._files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="cc-critical-care._files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="cc-critical-care._files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="cc-critical-care._files/libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cardiovascular Dysfunction</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr John Adabie Appiah </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Cardiac and vascular dysfunction may be classified as hemodynamic impairment or failure. Hemodynamic failure is also referred to as shock. The cardiovascular system (CVS) comprises the blood vessels, blood and the heart. Cardiovascular physiological reserve allows the system to function optimally even in some disease states. When physiological reserve is exhausted the body enters a state of dysfunction. Patients presenting in all acute disease states must have the CVS evaluated to identify dysfunction early, institute the appropriate treatment to prevent irreversible complications and avoid death.</p>
</section>
<section id="case-presentation" class="level2">
<h2 class="anchored" data-anchor-id="case-presentation">Case Presentation</h2>
<p>A 7-month-old female infant, presented with a 2-week history of fever and cough, and a day’s history of poor feeding, vomiting (2 episodes, non-bloody, non-bilous), and diarrhoea associated with lethargy. She presented to the clinic with severe respiratory distress, SpO<sub>2</sub>-98% on a non-rebreather mask at 15L/min. <em>Chest</em> - she had reduced air entry with coarse crackles in the middle and lower zones, more on the Right. <em>Circulation</em> - Heart Rate was 184 beats per minute, with cold extremities, Capillary Refill Time of 4 seconds, and weak pulse volume. Glasgow Coma Score was 14/15, temperature was 36.7<sup>o</sup>C. He was given intramuscular penicillin before being transferred to the tertiary hospital. Arterial blood gases revealed pH of 7.227, pCO<sub>2</sub> 33.1, pO<sub>2</sub> 59, and HCO<sub>3</sub> 14.</p>
</section>
<section id="shock" class="level2">
<h2 class="anchored" data-anchor-id="shock">Shock</h2>
<section id="definition" class="level3">
<h3 class="anchored" data-anchor-id="definition">Definition</h3>
<p>Shock is an acute process characterised by the body’s inability to deliver adequate oxygen to meet the metabolic demands of vital organs and tissues.</p>
</section>
<section id="pathophysiology" class="level3">
<h3 class="anchored" data-anchor-id="pathophysiology">Pathophysiology</h3>
<p>Among the key functions of the CVS is the delivery of blood to tissues, and perfusion. <a href="#fig-oxygen-delivery" class="quarto-xref">Figure&nbsp;1</a> summarizes the concept of oxygen delivery and adequate blood flow to the tissues with enough oxygen in the blood. This ensures that oxygen and nutrients are sent to the tissues to meet metabolic demands. Blood flow is dependent on stroke volume (mechanical function of the heart) and blood oxygen content of blood. Failure of the CVS to perform this function results in an imbalance in oxygen supply and tissue demand leading to anaerobic metabolism. This alternative energy production pathway to sustain life is associated with unwanted metabolites including lactic acid disturbing the homeostasis environment. When prolonged and not reversed promptly it usually leads to irreversible tissue damage and ultimately, death. Shock is a major cause of morbidity and mortality in children and a leading cause of emergency and intensive care unit admission. Stroke volume is dependent on the volume of blood at the end-diastole (preload), cardiac muscle integrity (myocardial contractility) and the resistance against which the heart pumps (afterload) &nbsp;is influenced by Oxygen carried by haemoglobin (Hb X Arterial oxygen saturation, SpO2) + Dissolved oxygen in the blood (0.003 × Arterial partial pressure of oxygen, PaO<sub>2</sub>). The oxygen delivery to tissues equation is represented by</p>
<div id="fig-oxygen-delivery" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oxygen-delivery-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/cc-oxygen-delivery-diagram.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oxygen-delivery-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Oxygen delivery (DO2) equation
</figcaption>
</figure>
</div>
<div style="border: 1px solid black;   padding: 1px; font-size: 14px">
<p><em>CO = Cardiac output<strong>,</strong> CaO<sub>2</sub> = arterial oxygen content, HR = Heart rate,</em> <em>SV = stroke volume, SpO<sub>2</sub> = arterial oxygen saturation, PaO<sub>2</sub> = partial pressure of arterial oxygen tension.</em></p>
</div>
</section>
<section id="clinical-stages-of-shock" class="level3">
<h3 class="anchored" data-anchor-id="clinical-stages-of-shock">Clinical stages of shock</h3>
<p>In impaired hemodynamic states, the body is not able to deliver blood, oxygen and nutrients to the tissues. This results in a cascade of biomedical processes initiated by anaerobic metabolism and if not corrected the processes lead to vascular endothelial injury and irreversible damage Figure 2. Shock may be categorized into stages to assist with diagnosis and management</p>
<div id="tbl-cc-shock-stages" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-cc-shock-stages-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Stages of shock with characteristics and clinical features
</figcaption>
<div aria-describedby="tbl-cc-shock-stages-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 42%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Stage</th>
<th>Pathophysiology</th>
<th>Clinical Features</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pre-shock</td>
<td>There is impaired hemodynamic status, but the body can fall on its physiological reserve and intrinsic autoregulation to compensate mechanisms to attenuate its untoward undesired effect.</td>
<td>Tachycardia, Tachypnoea, Cool core to periphery temperature</td>
</tr>
<tr class="even">
<td>Shock</td>
<td>Ensues when the compensatory reserve is exhausted with full-blown clinical manifestation of the cardiovascular system</td>
<td>Above <strong>plus</strong> Capillary refill time &gt; 3 seconds, +/- hypotension</td>
</tr>
<tr class="odd">
<td>End-organ dysfunction or failure</td>
<td>During this stage distant organs are affected. Usually, the terminal process results from loss of autoregulation leading to death or permanent organ damage in patients who survive.</td>
<td><em>Neurology</em> (altered level of consciousness) <em>Genito-urinary</em> (reduced urine output) <em>Laboratory</em> (evidence of organ dysfunction - liver, renal, coagulation etc.)</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="classification" class="level3">
<h3 class="anchored" data-anchor-id="classification">Classification</h3>
<ul>
<li><p>At the bedside, shock is conveniently classified as either compensated or uncompensated. The former refers to the early stages of shock when the body can mount a response to maintain perfusion. Uncompensated shock refers to the loss of the body’s compensatory response.</p></li>
<li><p>Other classifications based on core-to-peripheral body temperature are cold and warm shock. Clinical presentation may vary depending on the state of the patient and may drift in and out of these classifications. Without intervention and monitoring for stability, there should not be seen an improvement.</p></li>
</ul>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-ccShockCascade" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ccShockCascade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-ccShockCascade">flowchart TD
    A(Shock states with low perfusion)--&gt;B(Inadequate oxygen delivery);
    B--&gt;C(Anaerobic metabolism);
    C--&gt;D(Increased Lactate);
    C--&gt;E(Free radical);
    C--&gt;F(Immune response);
    E--&gt;G(Energy dependent ion &lt;br&gt; gated function loss, &lt;br&gt; microcirculation failure );
    E--&gt;H(Cellular death);
    F--&gt;H;
    F--&gt;I(Vascular dysregulation &lt;br&gt; and coagulopathy);
    G--&gt;J(Fluid leak,vasodilataion, &lt;br&gt; tissue swelling);
    H--&gt;K(Vital organ damage);
    I--&gt;L(Disseminated intravascular &lt;br&gt; coagulopathy);
    G--&gt;H
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ccShockCascade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Simplified cascade processes resulting from shock hypoxia, free radical formation, and hypoxia lead to inefficient anaerobic metabolism
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="types-of-shock" class="level3">
<h3 class="anchored" data-anchor-id="types-of-shock">Types of Shock</h3>
<p>Based on etiology shock may grouped into 5:</p>
<ol type="1">
<li><strong>Hypovolemic shock</strong> - the most common cause of shock in paediatrics. There is a reduction in venous return (preload) as a result of internal or external losses. Can be from fluid loss/redistribution, e.g.&nbsp;Vomiting, diarrhoea, burns, third-spacing, blood loss/hemorrhagic shock from trauma, Gastrointestinal bleeds.</li>
<li><strong>Cardiogenic shock</strong>- cardiac pump failure secondary to poor myocardial function. E.g. congenital heart diseases, cardiomyopathies- acute myocarditis, and arrhythmias.</li>
<li>In <strong>obstructive shock</strong> any mechanical impediment to adequate cardiac output. Eg. Tension pneumothorax, massive pulmonary embolism, cardiac tamponade.</li>
<li><strong>Distributive</strong> <strong>shock</strong>- inadequate vasomotor tone, severe vasodilatation and increased capillary permeability resulting in fluid moving into the interstitium. Examples include f anaphylactic and shock neurogenic shock.</li>
<li><strong>Septic sho</strong>ck is usually associated with a combination of distributive, hypovolemic and cardiogenic shock.</li>
</ol>
</section>
</section>
<section id="case-discussion" class="level2">
<h2 class="anchored" data-anchor-id="case-discussion">Case discussion</h2>
<p>According to the World Health Organization, shock may be clinically diagnosed when there are <strong>cold extremities, a capillary refill time of more than 3 seconds, and a fast weak pulse</strong>. Hypotension is usually a late sign and not a requirement to diagnose shock promptly. Additional signs attributed to other organs impacted are</p>
<ul>
<li>altered mental status,</li>
<li>low urine output,</li>
<li>rising liver enzymes, lactic acidosis or base deficit,</li>
<li>low mixed and central venous oxygen saturation.</li>
</ul>
<p>The 7-month-old baby presents with cold extremities, tachycardia, and slow delayed refill time consistent with shock. It is important to know the aetiology to manage appropriately. Hypovolemia, septic shock, and obstructive may be implicated as the causes of this child’s current condition.</p>
<ul>
<li>The history of the illness includes fever cough, poor feeding, vomiting and diarrhoea.</li>
<li>Fever, poor feeding, vomiting and diarrhoea suggest possible fluid losses and therefore hypovolemia.</li>
<li>Similarly, fever and features suggestive of infection could result from sepsis as a cause of the shock.</li>
<li>The cough, respiratory distress requiring oxygen, a hint of respiratory tract infection and possible complications such as pneumothorax.</li>
<li>Lastly, penicillin causes anaphylaxis hence there is a potential anaphylactic.</li>
</ul>
<p>The most probable cause of this infant’s shock is septic shock. Given fever, poor feeding, vomiting and diarrhoea the child may have low intravascular volume. &nbsp;The suspected infection has progressed to severe disease and the release of cytokines and other immune responses at the tissue and cellular level leading to damaged endothelium and consequently fluid leak from the intracellular space. Inflammatory response and endotoxins may damage vasodilation and myocardium with myocardial dysfunction.</p>
<p>The combination of these processes compromises perfusion to the tissues all tissues especially vital organs, the brain, kidney, liver and coagulation. A four-organ system model which included criteria for respiratory, cardiovascular, coagulation, and neurologic dysfunction has been developed to guide the diagnosis of sepsis. Whilst diagnosing sepsis at this point may still not be early enough, the new criteria provide new evidence that should sensitize clinicians to pick patients with infection who are critically ill.</p>
<p>Acute gastroenteritis is the most common cause of shock in children. Patients rapidly advance to dehydration and shock because of loss of intravascular volume</p>
<section id="clinical-presentation-and-diagnosis" class="level3">
<h3 class="anchored" data-anchor-id="clinical-presentation-and-diagnosis">Clinical Presentation and Diagnosis</h3>
<p>Shock is a clinical diagnosis based on history and examination. It is dependent on underlying pathology but there are overlaps in presentation.</p>
</section>
<section id="history" class="level3">
<h3 class="anchored" data-anchor-id="history">History</h3>
<ul>
<li>Hypovolemic shock- diarrhoea, vomiting, burns, bleeding, jaundice, trauma</li>
<li>Cardiogenic shock- known patient with congenital heart disease or cardiomyopathies, heart failure, easy fatiguability, darkened lips and fingers or toes, palpitations, chest pain, diaphoresis and taking frequent breaks during feeds</li>
<li>Distributive shock- drug history, allergies, spinal surgery,</li>
<li>Septic shock- fever, cough, jaundice, diarrhoea, vomiting, difficulty in breathing, loss of consciousness, seizures,</li>
</ul>
</section>
<section id="examination" class="level3">
<h3 class="anchored" data-anchor-id="examination">Examination</h3>
<ul>
<li>Tachycardia</li>
<li>Poor peripheral perfusion- cold extremities, CRT&gt;3s, weak pulse volume</li>
<li>Respiratory distress signs- tachypnea, use of accessory muscles, flaring of alae nasae, subcostal recession</li>
<li>Altered mental status</li>
<li>Hypotension (a late sign)</li>
<li>Oliguria</li>
<li>Signs of dehydration</li>
</ul>
<p>Other findings- jaundice, fever, skin lesions, chest signs of pneumonia or pneumothorax, upper airway obstruction murmurs or other heart sounds, signs of raised ICP, oedema, hypo/hyperglycemia, low SpO<sub>2</sub> &lt;92%</p>
</section>
<section id="approach-to-management" class="level3">
<h3 class="anchored" data-anchor-id="approach-to-management">Approach to management</h3>
<p>Shock is an emergency! Resuscitation must therefore be timely.</p>
</section>
<section id="initial-assessment" class="level3">
<h3 class="anchored" data-anchor-id="initial-assessment">Initial assessment</h3>
<ol type="1">
<li>Triage by following assessment and ensuring the airway is patent and maintainable, and breathing is appropriate for age.</li>
<li>Administer oxygen</li>
<li>Admit the patient to the emergency room.</li>
<li>Secure intravenous access (preferably the largest vein possible). Intraosseous access is equally useful when IV is difficult to obtain.</li>
<li>The first line of most untreated shock is fluid. Recent evidence suggests that large fluid boluses increase mortality.
<ol type="1">
<li>5-10 ml/kg over 30 minutes, this may be repeated every 30 minutes as needed (non-dehydration related shock). Balanced crystalloids are the fluid of choice (Ringer’s lactate is the crystalloid of preferable), Normal saline may be used in patients with head injuries. Avoid in with or at risk of acute kidney injury.</li>
</ol></li>
</ol>
</section>
<section id="second-survey" class="level3">
<h3 class="anchored" data-anchor-id="second-survey">Second survey</h3>
<p>Evaluate the patient for causes of shock and treat accordingly.</p>
<ol type="1">
<li>Hypovolemic
<ol type="a">
<li>Severe dehydration because of acute gastroenteritis (diarrhoea and vomiting). Rehydrate using WHO Plan B or C as appropriate</li>
<li>Severe anaemia – transfuse blood.</li>
<li>Hemorrhage – transfuse blood without blood products as needed</li>
</ol></li>
<li>Monitor response to the fluid bolus every 15 – 30 minutes.</li>
</ol>
</section>
<section id="investigations" class="level3">
<h3 class="anchored" data-anchor-id="investigations">Investigations</h3>
<p>Once the patient has been resuscitated tailored but detailed investigations are needed.</p>
<section id="laboratory" class="level4">
<h4 class="anchored" data-anchor-id="laboratory">Laboratory</h4>
<ol type="1">
<li>FBC- Anemia, Leukopenia/leukocytosis, thrombocytopenia</li>
<li>Arterial blood gases- acidosis (metabolic/respiratory), low PaO2, high/low PCO2, high lactate, high anion gap</li>
<li>Deranged liver and renal function test</li>
<li>Abnormal electrolytes (low Calcium, hyper/hypokalemia)</li>
<li>Abnormal clotting profile</li>
<li>Septic screen - blood, urine, nasopharyngeal swabs, stool, CSF</li>
<li>Chest x-ray indicated suspected lung pathology such as pneumothorax and infections.</li>
<li>Echo/ECG – useful for diagnosis and monitoring of shock</li>
<li>Neuroimaging for suspected brain abscess, meningitis and encephalitis.</li>
<li>Markers of inflammation/infection- CRP, ESR and procalcitonin. These will be determined by circumstances. It may also be used to guide antibiotic therapy decisions. &nbsp;</li>
</ol>
</section>
</section>
<section id="additional-treatment" class="level3">
<h3 class="anchored" data-anchor-id="additional-treatment">Additional treatment</h3>
<p>For shock not responding to fluid of 30-40 ml/kg the following may be added.</p>
<ol type="1">
<li><strong>Cardiogenic shock</strong> - Inotropes to improve contractility– adrenaline or dobutamine.</li>
<li>O<strong>bstructive shock</strong>
<ol type="a">
<li>Tension pneumothorax – thoracostomy/chest tube insertion</li>
<li>massive pulmonary embolism – anticoagulants</li>
<li>cardiac tamponade - pericardiocentesis</li>
</ol></li>
<li><strong>Distributive</strong> <strong>shock</strong> – adrenaline, phenylephrine</li>
<li><strong>Septic shock</strong>
<ol type="a">
<li>For fluid refractory - noradrenaline, adrenaline, dobutamine</li>
<li>For vasopressor and inotrope refractory - steroid stress dose</li>
<li>Antimicrobial therapy in sepsis within an hour.</li>
</ol></li>
</ol>
</section>
<section id="supportive-therapy" class="level3">
<h3 class="anchored" data-anchor-id="supportive-therapy">Supportive therapy</h3>
<p>In inotrope-refractory shock, steroids may be given for adrenal insufficiency.</p>
<ol type="1">
<li>Intensive Care Unit admission as required</li>
<li>Neuroprotective measures- normothermia, normoglycemia, anti-seizure(if indicated), hyperosmolar therapy</li>
<li>Providing ventilatory support- invasive vs non-invasive</li>
<li>Worsening cardiac function requires invasive treatment options like ECMO (Extracorporeal Membrane Oxygenation) and ventricular-assisted devices. The underlying cause should be looked at after resuscitation and stabilization</li>
<li>Correct all electrolyte abnormalities</li>
<li>Nutritional rehabilitation- early initiation of enteral feeds associated with good outcomes</li>
<li>Analgesia, antipyretics, anxiolytics. Hemotransfusion if indicated.</li>
</ol>
</section>
</section>
<section id="monitoring" class="level2">
<h2 class="anchored" data-anchor-id="monitoring">Monitoring</h2>
<p>The patients must be continuously monitored as treatment is instituted. Inotropes titrated to effect per the average values per patient age (pulse rate, CRT, BP, RR, SPO2 and urine output). In low-resource facilities,</p>
<p>Monitoring of abnormal laboratory indices for improvement/deterioration.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Shock is an emergency requiring early recognition, triaging and treatment. Initial treatment for almost all shock is careful restrictive fluid resuscitation. Vasoactive drugs may be required in patients who are refractory to fluid. Patients with shock may be fit from locations where monitoring can be meticulously adhered to.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>